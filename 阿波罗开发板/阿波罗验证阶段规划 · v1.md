阿波罗验证阶段规划 · v1.0

只放“每个阶段该做什么 + 如何判定通过”，不放行级细节。以最新文件/日志为唯一依据；涉及 SDRAM 参数时以《阿波罗 STM32H743 开发指南》SDRAM 443–464 页为源。

P0 系统基线（通用入口）

目标：系统时钟/串口可用，基础日志输出。

入口条件：—

最小 .ioc：无（默认工程即可）。

执行要点：上电 → SystemClock_Config → USART1 打印“HELLO/版本”。

验收：冷启动 Boot log 正常、无异常复位；记录启动时长。

风险/回滚：若时钟异常→恢复上一次可工作的 .elf；核对 HSE/PLL 选择。

P1 LTDC 基线（片内 D1 SRAM 帧缓冲）

目标：主屏显示 8 条等宽竖彩条稳定。

入口条件：P0 通过。

最小 .ioc：开启 LTDC；PLL3R 设定像素时钟目标≈10 MHz；相关引脚复用。

执行要点（高层）

Layer1 / RGB565；

CFBLR=0x03C003C0（960B stride，严禁 0x…03C3）；

仅一个“立即重载”点；背光开关在重载前后分明；

帧缓冲暂放 D1 SRAM。

验收：

彩条稳定 ≥60 s；

串口打印：LTDCclk≈10 MHz, CFBAR, CFBLR, CFBLNR；

Boot ≤ 200 ms（目标）。

风险/回滚：倾斜/撕裂→首先核对 CFBLR；回滚至上一次可工作图层配置。

P2 片内 SRAM(D1) 内存通道验证（与 LTDC/DMA2D 协同）

目标：确认片内 D1 SRAM 对 CPU/DMA2D/LTDC 的协同访问稳定。

入口条件：P1 通过。

最小 .ioc：无新增。

执行要点（高层）

DMA2D R2M 填充 D1 SRAM 帧缓冲；

CPU 读样本、DMA2D/CPU 写后做 32B 对齐 Cache Clean/Invalidate；

仍保持单一立即重载。

验收：DMA2D 生成彩条稳定 ≥60 s；TCIF 正常；彩条取样值正确。

风险/回滚：若出现花屏→优先核查 Cache 协同；禁用优化做 A/B。

P3 DMA2D 基线（功能与性能）

目标：DMA2D R2M/（可选 M2M）稳定运行；寄存器/中断状态正确。

入口条件：P1、P2 通过。

最小 .ioc：无新增。

执行要点（高层）

R2M 全屏单色 → 8 彩条合成；

NLR=480×272，启动/完成检查 ISR(TCIF)；

写后 Invalidate，CPU 写后 Clean。

验收：R2M、（可选 M2M）通过；屏显稳定；关键寄存器打印 6 行内。

风险/回滚：CEIF→优先核查 NLR 与 OPFCCR 顺序；回滚到单色填充。

P4 SDRAM Bank1 Bring-up（HAL 优先）

目标：Bank1@0xC0000000 可读写，短/中等规模测试通过。

入口条件：P1–P3 通过。

最小 .ioc：开启 FMC/SDRAM1（Bank1）、FMC 时钟源 D1HCLK、相关 GPIO 设 AF12+VeryHigh；参数以开发指南 P443–464为准（CAS、列/行、刷新计数等）。

执行要点（高层）

HAL 初始化，ReadBurst=OFF 起步；

三点位 16×halfword 烟雾测试（0xC0000000 / +1MB / +2MB-32）；

64B & 128KB 单块测试（不跨 Cache 行或注意协同）。

验收：以上测试 0 错；SDSR: NORMAL & BUSY=0；打印 SDCR1/SDTR1/SDRTR/SDSR。

风险/回滚：若 BusFault→先确认 Bank 与地址一致、GPIO AF12 全量、时钟/刷新计数；回滚到片内 SRAM 工作态。

P5 LTDC 帧缓冲迁移到 SDRAM Bank1

目标：Layer1 CFBAR 指向 0xC0000000，显示稳定。

入口条件：P4 通过。

最小 .ioc：无新增（继承 P4）。

执行要点（高层）

CFBAR=0xC0000000；保持 CFBLR=0x03C003C0；

DMA2D→SDRAM 写后 Invalidate；

仍一个立即重载；背光切换时序保持。

验收：8 彩条稳定 ≥60 s；打印三项：

SDRAM OK: base=0xC0000000, SDCLK=?, CAS=?, REFRESH=?

SDSR=Normal, BUSY=0

LTDCclk≈10 MHz, CFBAR/CFBLR/CFBLNR

风险/回滚：花屏/倾斜→核对 CFBLR 与 Cache 协同；必要时暂关 RBURST。

后续阶段（占位）：P6 DCMI+LCD 采集回显、P7 QSPI+LittleFS、P8 无线/OTA 等 —— 待当前四阶段闭环后再展开。